$ ->
  $(document).click (event) ->
    hideControlMenusIfNecessary(event)

  $(document).keyup (event) ->
    if event.keyCode == 13 or event.keyCode == 27
      hideControlMenusIfNecessary(event)
      hideOverlayIfNecessary(event)
      
  $('#overlay-close').on "click", (event) ->
    overlayDiv.animate
      opacity: 0.0
    , 100, ->
      overlayDiv.hide()
      
  hideOverlayIfNecessary = (event) ->
    unless event.target.id == 'edit-thought-text-overlay'
      unless overlayDiv.css("display") is "none"
        overlayDiv.animate
          opacity: 0.0
        , 100, ->
          overlayDiv.hide()
        
  hideRecentListIfNecessary = (event) ->
    if recentThoughtWallsDiv.css('opacity') is "1"
      toggleVisibilityOfRecentThoughtWallsDiv()
  
  hideShareLinkIfNecessary = (event) ->
    if shareLinkDiv.css('opacity') is "1" and event.target.id != 'share-link-text'
      toggleVisibilityOfShareLinkDiv()
  
  hideLayoutSelectorIfNecessary = (event) ->
    if layoutSelectorDiv.css('opacity') is "1" and event.target.id != 'layout-selector-control'
      toggleVisibilityOfLayoutSelectorDiv()
  
  hideThemeSelectorIfNecessary = (event) ->
    if themeSelectorDiv.css('opacity') is "1" and event.target.id != 'theme-selector-control'
      toggleVisibilityOfThemeSelectorDiv()
      
  hideStarDivIfNecessary = (event) ->
    if starDiv.css('opacity') is "1" and event.target.id != 'star-control'
      toggleVisibilityOfStarDiv()
  
  hideThoughtHistoriesIfNecessary = (event) ->
    classOfTargetElement = event.target.getAttribute("class")
    if classOfTargetElement is null || classOfTargetElement.indexOf("thought-history-link") == -1
        hideAllThoughtHistoryBoxes()
        
  hideControlMenusIfNecessary = (event) ->
    hideStarDivIfNecessary(event)
    hideRecentListIfNecessary(event)
    hideShareLinkIfNecessary(event)
    hideLayoutSelectorIfNecessary(event)
    hideThemeSelectorIfNecessary(event)
    hideThoughtHistoriesIfNecessary(event)
  
$ ->
  $(document).click (event) ->
    hideRecentListIfNecessary(event)
    hideShareLinkIfNecessary(event)
    hideThemeSelectorIfNecessary(event)
    hideThoughtHistoriesIfNecessary(event)

  $(document).keyup (event) ->
    if event.keyCode == 13 or event.keyCode == 27
      hideOverlayIfNecessary()
      hideRecentListIfNecessary()
      hideThoughtHistoriesIfNecessary(event)
      
  $('#overlay-close').on "click", (event) ->
    overlayDiv.animate
      opacity: 0.0
    , 100, ->
      overlayDiv.hide()
      
  hideOverlayIfNecessary = ->
    unless overlayDiv.css("display") is "none"
      overlayDiv.animate
        opacity: 0.0
      , 100, ->
        overlayDiv.hide()
      
  hideRecentListIfNecessary = (event) ->
    if recentThoughtWallsDiv.css('opacity') is "1"
      toggleVisibilityOfRecentThoughtWallsDiv()
  
  hideShareLinkIfNecessary = (event) ->
    if shareLinkDiv.css('opacity') is "1" and event.target.id != 'share-link-text'
      toggleVisibilityOfShareLinkDiv()
  
  hideThemeSelectorIfNecessary = (event) ->
    if themeSelectorDiv.css('opacity') is "1" and event.target.id != 'share-link-text'
      toggleVisibilityOfThemeSelectorDiv()
  
  hideThoughtHistoriesIfNecessary = (event) ->
    classOfTargetElement = event.target.getAttribute("class")
    if classOfTargetElement is null || classOfTargetElement.indexOf("thought-history-link") == -1
        hideAllThoughtHistoryBoxes()